harbor:
  expose:
    type: ingress
    tls:
      enabled: true
      # Is done by the Ingress Controller
      certSource: secret
      secret:
        secretName: harbor.build.chorus-tre.local-tls
    ingress:
      hosts:
        core: harbor.build.chorus-tre.local
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/proxy-body-size: "0"

  externalURL: https://harbor.build.chorus-tre.local

  persistence:
    persistentVolumeClaim:
      registry:
        size: 1Ti
      jobService:
        size: 2Gi

  updateStrategy:
    type: Recreate # as RWM is not supported.

  imageChartStorage:
    type: filesystem # Using the above PVC

  existingSecretAdminPassword: harbor-secret
  existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD

  # Key is:
  #  - secretKey # 16 charts
  existingSecretSecretKey: harbor-secret

  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

  core:
    # Key is:
    # - secret # 16 chars
    existingSecret: harbor-secret
    existingXsrfSecret: harbor-secret
    existingXsrfSecretKey: CSRF_KEY # 32 chars
    secretName: harbor-tls-secret
    priorityClassName: high-priority

  jobservice:
    existingSecret: harbor-secret
    existingSecretKey: JOBSERVICE_SECRET
    jobLoggers:
      - database
    priorityClassName: low-priority

  registry:
    existingSecret: harbor-secret
    existingSecretKey: REGISTRY_HTTP_SECRET # string of 16 chars
    credentials:
      username: "admin"
      password: ""
      # Keys are:
      #  - REGISTRY_PASSWD
      #  - REGISTRY_HTPASSWD
      existingSecret: harbor-secret
    priorityClassName: high-priority

  portal:
    priorityClassName: medium-priority
  nginx:
    priorityClassName: medium-priority
  trivy:
    priorityClassName: batch-priority
  exporter:
    priorityClassName: low-priority

  database:
    type: external
    external:
      host: "chorus-local-harbor-db-postgresql"
      port: "5432"
      username: "harbor"
      password: ""
      # Key is:
      # - password
      existingSecret: harbor-db-secret
      sslmode: require

  redis:
    type: external
    external:
      addr: "chorus-local-harbor-cache-valkey-master:6379"
      # Auth will not work with helm template,
      # See: https://github.com/goharbor/harbor-helm/issues/1641
      password: ""


certificate:
  enabled: false

  # Same as above: harbor.core.secretName
  secretName: harbor-tls-secret

  duration: 2169h # 90d
  renewBefore: 360h # 15d

  issuerRef:
    name: CHANGEME-issuer

configJob:
  enabled: true
  priorityClassName: medium-priority
  image:
    domain: "harbor.build.chorus-tre.ch"
    namespace: "docker_proxy/library"
    tag: "3.12-slim"
    pullPolicy: IfNotPresent
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded,BeforeHookCreation
  backoffLimit: 3
  verifySSL: "true"
  logLevel: "INFO"
  robotSecretPrefix: harbor-robot-

projects:
  # - name: example-project
  #   public: false
  #   auto_scan: true
  #   severity: "low"
  #   enable_content_trust: false
  #   reuse_sys_cve_allowlist: true
  #   storage_quota: -1
  - name: apps
    auto_scan: false
  - name: chorus
    auto_scan: false
  - name: services
    auto_scan: false
  - name: docker_proxy
    auto_scan: false
    registry:
      name: docker-hub
      type: docker-hub
      url: https://hub.docker.com
      insecure: false

robots:
  # - name: example-robot
  #   description: ''
  #   duration: -1
  #   disable: false
  #   permissions: []
  - name: chorus-local
    permissions:
      - kind: system
        namespace: /
        access:
          - resource: project
            action: list
          - resource: registry
            action: list
          - resource: registry
            action: read
      - kind: project
        namespace: apps
        access:
          - resource: artifact
            action: list
          - resource: artifact
            action: read
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: read
          - resource: tag
            action: list
      - kind: project
        namespace: chorus
        access:
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: read
      - kind: project
        namespace: services
        access:
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: read
      - kind: project
        namespace: docker_proxy
        access:
          - resource: artifact
            action: list
          - resource: artifact
            action: read
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: read
          - resource: tag
            action: list
  - name: chorus-build
    permissions:
      # System-level permissions
      - kind: system
        namespace: /
        access:
          # Audit Log
          - resource: audit-log
            action: list
          # Catalog
          - resource: catalog
            action: read
          # Garbage Collection
          - resource: garbage-collection
            action: create
          - resource: garbage-collection
            action: list
          - resource: garbage-collection
            action: read
          - resource: garbage-collection
            action: stop
          - resource: garbage-collection
            action: update
          # Job Service Monitor
          - resource: jobservice-monitor
            action: list
          - resource: jobservice-monitor
            action: stop
          # Label
          - resource: label
            action: create
          - resource: label
            action: delete
          - resource: label
            action: read
          - resource: label
            action: update
          # Preheat Instance
          - resource: preheat-instance
            action: create
          - resource: preheat-instance
            action: delete
          - resource: preheat-instance
            action: list
          - resource: preheat-instance
            action: read
          - resource: preheat-instance
            action: update
          # Project
          - resource: project
            action: create
          - resource: project
            action: list
          # Purge Audit
          - resource: purge-audit
            action: create
          - resource: purge-audit
            action: list
          - resource: purge-audit
            action: read
          - resource: purge-audit
            action: stop
          - resource: purge-audit
            action: update
          # Quota
          - resource: quota
            action: list
          - resource: quota
            action: read
          # Registry
          - resource: registry
            action: create
          - resource: registry
            action: delete
          - resource: registry
            action: list
          - resource: registry
            action: read
          - resource: registry
            action: update
          # Replication
          - resource: replication
            action: create
          - resource: replication
            action: list
          - resource: replication
            action: read
          # Replication Adapter
          - resource: replication-adapter
            action: list
          # Replication Policy
          - resource: replication-policy
            action: create
          - resource: replication-policy
            action: delete
          - resource: replication-policy
            action: list
          - resource: replication-policy
            action: read
          - resource: replication-policy
            action: update
          # Scan All
          - resource: scan-all
            action: create
          - resource: scan-all
            action: read
          - resource: scan-all
            action: stop
          - resource: scan-all
            action: update
          # Scanner
          - resource: scanner
            action: create
          - resource: scanner
            action: delete
          - resource: scanner
            action: list
          - resource: scanner
            action: read
          - resource: scanner
            action: update
          # Security Hub
          - resource: security-hub
            action: list
          - resource: security-hub
            action: read
          # System Volumes
          - resource: system-volumes
            action: read
      # Project-level permissions for chorus
      - kind: project
        namespace: chorus
        access:
          # Accessory
          - resource: accessory
            action: list
          # Artifact
          - resource: artifact
            action: create
          - resource: artifact
            action: delete
          - resource: artifact
            action: list
          - resource: artifact
            action: read
          # Artifact Addition
          - resource: artifact-addition
            action: read
          # Artifact Label
          - resource: artifact-label
            action: create
          - resource: artifact-label
            action: delete
          # Immutable Tag
          - resource: immutable-tag
            action: create
          - resource: immutable-tag
            action: delete
          - resource: immutable-tag
            action: list
          - resource: immutable-tag
            action: update
          # Label
          - resource: label
            action: create
          - resource: label
            action: delete
          - resource: label
            action: list
          - resource: label
            action: read
          - resource: label
            action: update
          # Log
          - resource: log
            action: list
          # Project Metadata
          - resource: metadata
            action: create
          - resource: metadata
            action: delete
          - resource: metadata
            action: list
          - resource: metadata
            action: read
          - resource: metadata
            action: update
          # Notification Policy
          - resource: notification-policy
            action: create
          - resource: notification-policy
            action: delete
          - resource: notification-policy
            action: list
          - resource: notification-policy
            action: read
          - resource: notification-policy
            action: update
          # Preheat Policy
          - resource: preheat-policy
            action: create
          - resource: preheat-policy
            action: delete
          - resource: preheat-policy
            action: list
          - resource: preheat-policy
            action: read
          - resource: preheat-policy
            action: update
          # Project
          - resource: project
            action: delete
          - resource: project
            action: read
          - resource: project
            action: update
          # Quota
          - resource: quota
            action: read
          # Repository
          - resource: repository
            action: delete
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: push
          - resource: repository
            action: read
          - resource: repository
            action: update
          # SBOM
          - resource: sbom
            action: create
          - resource: sbom
            action: read
          - resource: sbom
            action: stop
          # Scan
          - resource: scan
            action: create
          - resource: scan
            action: read
          - resource: scan
            action: stop
          # Scanner
          - resource: scanner
            action: create
          - resource: scanner
            action: read
          # Tag
          - resource: tag
            action: create
          - resource: tag
            action: delete
          - resource: tag
            action: list
          # Tag Retention
          - resource: tag-retention
            action: create
          - resource: tag-retention
            action: delete
          - resource: tag-retention
            action: list
          - resource: tag-retention
            action: read
          - resource: tag-retention
            action: update
      # Project-level permissions for services
      - kind: project
        namespace: services
        access:
          # Accessory
          - resource: accessory
            action: list
          # Artifact
          - resource: artifact
            action: create
          - resource: artifact
            action: delete
          - resource: artifact
            action: list
          - resource: artifact
            action: read
          # Artifact Addition
          - resource: artifact-addition
            action: read
          # Artifact Label
          - resource: artifact-label
            action: create
          - resource: artifact-label
            action: delete
          # Immutable Tag
          - resource: immutable-tag
            action: create
          - resource: immutable-tag
            action: delete
          - resource: immutable-tag
            action: list
          - resource: immutable-tag
            action: update
          # Label
          - resource: label
            action: create
          - resource: label
            action: delete
          - resource: label
            action: list
          - resource: label
            action: read
          - resource: label
            action: update
          # Log
          - resource: log
            action: list
          # Project Metadata
          - resource: metadata
            action: create
          - resource: metadata
            action: delete
          - resource: metadata
            action: list
          - resource: metadata
            action: read
          - resource: metadata
            action: update
          # Notification Policy
          - resource: notification-policy
            action: create
          - resource: notification-policy
            action: delete
          - resource: notification-policy
            action: list
          - resource: notification-policy
            action: read
          - resource: notification-policy
            action: update
          # Preheat Policy
          - resource: preheat-policy
            action: create
          - resource: preheat-policy
            action: delete
          - resource: preheat-policy
            action: list
          - resource: preheat-policy
            action: read
          - resource: preheat-policy
            action: update
          # Project
          - resource: project
            action: delete
          - resource: project
            action: read
          - resource: project
            action: update
          # Quota
          - resource: quota
            action: read
          # Repository
          - resource: repository
            action: delete
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: push
          - resource: repository
            action: read
          - resource: repository
            action: update
          # SBOM
          - resource: sbom
            action: create
          - resource: sbom
            action: read
          - resource: sbom
            action: stop
          # Scan
          - resource: scan
            action: create
          - resource: scan
            action: read
          - resource: scan
            action: stop
          # Scanner
          - resource: scanner
            action: create
          - resource: scanner
            action: read
          # Tag
          - resource: tag
            action: create
          - resource: tag
            action: delete
          - resource: tag
            action: list
          # Tag Retention
          - resource: tag-retention
            action: create
          - resource: tag-retention
            action: delete
          - resource: tag-retention
            action: list
          - resource: tag-retention
            action: read
          - resource: tag-retention
            action: update
      # Project-level permissions for apps
      - kind: project
        namespace: apps
        access:
          # Accessory
          - resource: accessory
            action: list
          # Artifact
          - resource: artifact
            action: create
          - resource: artifact
            action: delete
          - resource: artifact
            action: list
          - resource: artifact
            action: read
          # Artifact Addition
          - resource: artifact-addition
            action: read
          # Artifact Label
          - resource: artifact-label
            action: create
          - resource: artifact-label
            action: delete
          # Immutable Tag
          - resource: immutable-tag
            action: create
          - resource: immutable-tag
            action: delete
          - resource: immutable-tag
            action: list
          - resource: immutable-tag
            action: update
          # Label
          - resource: label
            action: create
          - resource: label
            action: delete
          - resource: label
            action: list
          - resource: label
            action: read
          - resource: label
            action: update
          # Log
          - resource: log
            action: list
          # Project Metadata
          - resource: metadata
            action: create
          - resource: metadata
            action: delete
          - resource: metadata
            action: list
          - resource: metadata
            action: read
          - resource: metadata
            action: update
          # Notification Policy
          - resource: notification-policy
            action: create
          - resource: notification-policy
            action: delete
          - resource: notification-policy
            action: list
          - resource: notification-policy
            action: read
          - resource: notification-policy
            action: update
          # Preheat Policy
          - resource: preheat-policy
            action: create
          - resource: preheat-policy
            action: delete
          - resource: preheat-policy
            action: list
          - resource: preheat-policy
            action: read
          - resource: preheat-policy
            action: update
          # Project
          - resource: project
            action: delete
          - resource: project
            action: read
          - resource: project
            action: update
          # Quota
          - resource: quota
            action: read
          # Repository
          - resource: repository
            action: delete
          - resource: repository
            action: list
          - resource: repository
            action: pull
          - resource: repository
            action: push
          - resource: repository
            action: read
          - resource: repository
            action: update
          # SBOM
          - resource: sbom
            action: create
          - resource: sbom
            action: read
          - resource: sbom
            action: stop
          # Scan
          - resource: scan
            action: create
          - resource: scan
            action: read
          - resource: scan
            action: stop
          # Scanner
          - resource: scanner
            action: create
          - resource: scanner
            action: read
          # Tag
          - resource: tag
            action: create
          - resource: tag
            action: delete
          - resource: tag
            action: list
          # Tag Retention
          - resource: tag-retention
            action: create
          - resource: tag-retention
            action: delete
          - resource: tag-retention
            action: list
          - resource: tag-retention
            action: read
          - resource: tag-retention
            action: update
