harbor:
  expose:
    type: ingress
    tls:
      enabled: true
      # Is done by the Ingress Controller
      certSource: secret
      secret:
        secretName: harbor.build.chorus-tre.local-tls
    ingress:
      hosts:
        core: harbor.build.chorus-tre.local
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/proxy-body-size: "0"

  externalURL: https://harbor.build.chorus-tre.local

  persistence:
    persistentVolumeClaim:
      registry:
        size: 1Ti
      jobService:
        size: 2Gi

  updateStrategy:
    type: Recreate # as RWM is not supported.

  imageChartStorage:
    type: filesystem # Using the above PVC

  existingSecretAdminPassword: harbor-secret
  existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD

  # Key is:
  #  - secretKey # 16 charts
  existingSecretSecretKey: harbor-secret

  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

  core:
    # Key is:
    # - secret # 16 chars
    existingSecret: harbor-secret
    existingXsrfSecret: harbor-secret
    existingXsrfSecretKey: CSRF_KEY # 32 chars
    secretName: harbor-tls-secret
    priorityClassName: high-priority

  jobservice:
    existingSecret: harbor-secret
    existingSecretKey: JOBSERVICE_SECRET
    jobLoggers:
      - database
    priorityClassName: low-priority

  registry:
    existingSecret: harbor-secret
    existingSecretKey: REGISTRY_HTTP_SECRET # string of 16 chars
    credentials:
      username: "admin"
      password: ""
      # Keys are:
      #  - REGISTRY_PASSWD
      #  - REGISTRY_HTPASSWD
      existingSecret: harbor-secret
    priorityClassName: high-priority

  portal:
    priorityClassName: medium-priority
  nginx:
    priorityClassName: medium-priority
  trivy:
    priorityClassName: batch-priority
  exporter:
    priorityClassName: low-priority

  database:
    type: external
    external:
      host: "chorus-local-harbor-db-postgresql"
      port: "5432"
      username: "harbor"
      password: ""
      # Key is:
      # - password
      existingSecret: harbor-db-secret
      sslmode: require

  redis:
    type: external
    external:
      addr: "chorus-local-harbor-cache-valkey-master:6379"
      # Auth will not work with helm template,
      # See: https://github.com/goharbor/harbor-helm/issues/1641
      password: ""


certificate:
  enabled: false

  # Same as above: harbor.core.secretName
  secretName: harbor-tls-secret

  duration: 2169h # 90d
  renewBefore: 360h # 15d

  issuerRef:
    name: CHANGEME-issuer

configJob:
  enabled: true
  priorityClassName: medium-priority
  image:
    domain: "harbor.build.chorus-tre.ch"
    namespace: "docker_proxy/library"
    tag: "3.12-slim"
    pullPolicy: IfNotPresent
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded,BeforeHookCreation
  backoffLimit: 3
  ttlSecondsAfterFinished: 120
  verifySSL: "true"
  logLevel: "INFO"
  robotSecretPrefix: harbor-robot-

projects: {}
  # Example project with all available settings and their defaults:
  # - project_name: example-project
  #   public: false                          # Make project publicly accessible
  #   auto_scan: true                        # Automatically scan images on push
  #   severity: low                          # Severity threshold: low, medium, high, critical
  #   enable_content_trust: false            # Enable Docker Content Trust
  #   enable_content_trust_cosign: false     # Enable Cosign signature verification
  #   prevent_vul: false                     # Prevent vulnerable images from running
  #   auto_sbom_generation: false            # Automatically generate SBOM
  #   reuse_sys_cve_allowlist: true          # Use system-level CVE allowlist
  #   storage_limit: -1                      # Storage quota in bytes (-1 = unlimited)
  #   proxy_speed_kb: -1                     # Proxy cache speed limit in KB/s (-1 = unlimited)
  #   cve_allowlist:                         # Project-specific CVE allowlist (optional)
  #     items:
  #       - cve_id: CVE-2021-1234
  #       - cve_id: CVE-2021-5678
  #     expires_at: 1735689600               # Unix timestamp (optional)
  #   registry:                              # For proxy cache projects only
  #     name: docker-hub
  #     type: docker-hub
  #     url: https://hub.docker.com
  #     insecure: false
  #     credential:                          # Optional credentials
  #       type: basic
  #       access_key: username
  #       access_secret: password
  #   retention_policy:                      # Tag retention policy (optional)
  #     algorithm: or                        # Rule matching algorithm: "or" or "and"
  #     rules:
  #       - priority: 1                      # Lower number = higher priority
  #         disabled: false
  #         action: retain                   # Action to take: "retain"
  #         template: latestPushedK          # Template: "always", "latestPushedK", "latestPulledN", "nDaysSinceLastPush", "nDaysSinceLastPull"
  #         params:
  #           latestPushedK: 10              # Keep 10 most recently pushed tags
  #         tag_selectors:
  #           - kind: doublestar             # Pattern type: "doublestar"
  #             decoration: matches          # Match type: "matches" or "excludes"
  #             pattern: "**"                # Tag pattern
  #         scope_selectors:
  #           repository:                    # Repository selectors
  #             - kind: doublestar
  #               decoration: repoMatches    # "repoMatches" or "repoExcludes"
  #               pattern: "**"              # Repository pattern
  #     trigger:
  #       kind: Schedule                     # Trigger type: "Schedule"
  #       settings:
  #         cron: "0 0 0 * * *"              # Cron expression (daily at midnight)

replications: {}
  # Example replication with all available settings and their defaults:
  # - name: example-replication
  #   mode: pull                    # Required: 'pull' or 'push'
  #   description: ""               # Optional description
  #   registry:                     # Required: source (pull) or destination (push) registry
  #     name: example-registry
  #     type: harbor                # Registry type: harbor, docker-hub, etc.
  #     url: https://registry.example.com
  #     description: ""
  #     insecure: false
  #     credential:                 # Optional credentials
  #       type: basic
  #       access_key: username
  #       access_secret: password
  #   dest_namespace: ""            # Default: preserve source namespace
  #   filters: []                   # Default: no filters (replicate all)
  #   flattening: 1                 # Default: flatten 1 level (0-3)
  #   trigger:                      # Default: manual trigger
  #     mode: manual                # Options: manual, scheduled, event_based
  #     cron: ""                    # Required if mode=scheduled
  #   replicate_deletion: false     # Default: don't replicate deletions
  #   bandwidth: -1                 # Default: unlimited (-1 = no limit, in KB/s)
  #   override: true                # Default: override existing images
  #   enabled: true                 # Default: policy is enabled
  #   copyByChunk: false            # Default: don't use chunked copy

robots: {}
  # Example system-level robot account (has access across all projects):
  # - name: example-system-robot
  #   description: System-level robot for CI/CD
  #   duration: -1                           # Duration in days (-1 = never expires)
  #   disable: false                         # Disable the robot account
  #   permissions:
  #     # System-level permissions (namespace must be "/")
  #     - kind: system
  #       namespace: /
  #       access:
  #         - resource: project              # Resource type
  #           action: list                   # Action: create, delete, list, read, update, push, pull, etc.
  #           effect: allow                  # Effect: allow or deny (default: allow)
  #         - resource: registry
  #           action: read
  #           effect: allow
  #     # Project-level permissions (namespace is project name)
  #     - kind: project
  #       namespace: my-project
  #       access:
  #         - resource: repository
  #           action: pull
  #           effect: allow
  #         - resource: repository
  #           action: push
  #           effect: allow
  #         - resource: artifact
  #           action: read
  #           effect: allow
  #         # Example of deny rule
  #         - resource: artifact
  #           action: delete
  #           effect: deny
